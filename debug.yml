---
- hosts: windows
  gather_facts: false

  tasks:
  - name: Run detectPSVersion
    psexec:
        hostname: '{{ansible_host}}'
        connection_username: hccadmin
        connection_password: ServiceP@ss123!
        encrypt: no
        integrity_level: elevated
        process_username: hccadmin
        process_password: ServiceP@ss123!
        executable: powershell.exe
        arguments: '-'
        stdin: |
            $ErrorActionPreference = "Stop"
            Write-Host $PSVersionTable.PSVersion.ToString()
            exit
    delegate_to: localhost
    register: powershell_version

  - name: Output  
    debug:
      var: powershell_version.stdout_lines